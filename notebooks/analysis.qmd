---
title: "Depression among patients living with diabetes - Analysis"
author: "Eric Anku"
format: html
---

```{r import-libraries}
pacman::p_load(
  tidyverse, # Data manipulation and visualisation
  gtsummary, # Summary and regression tables
  finalfit, # Modelling
  rio, # Import data
  here, # File management
  skimr, # Skim dataset
  broom, # Tidy output
  car, # Variance inflation factor
  rstatix # Pipe friendly statistical test
)
```

# Introduction


```{r import-dataset}
# Import datasets
df <- import(here("data", "clean_data.RData"), trust = TRUE) # Full dataset
demographics <- import(here("data", "demos.RData"), trust = TRUE) # Demographics subset
depress <- import(here("data", "depression.RData"), trust = TRUE) # Depression subset
fam_func <- import(here("data", "family.RData"), trust = TRUE) # Family functionality
health <- import(here("data", "health.RData"), trust = TRUE) # Health characteristics 
```

```{r skim-data}
skim(df)
```

## Normality test

```{r shapiro-wilk-test}
# Create function
shapiro_test <- function(x) {
  shapiro_resut <- shapiro.test(x)
  return(shapiro_resut$p.value)
}

# Extract numeric variables
numeric_vars <- df |>
  select_if(is.numeric)

# Apply function to numeric variables
shapiro_p_values <- numeric_vars |>
  summarise(across(everything(), ~ shapiro_test(.))) |>
  pivot_longer(everything(), names_to = "Variable", values_to = "P values")

# Print shapiro_result
print(shapiro_p_values)
```

***

# Descriptive and Inferential statistics

```{r descriptives}
# Demographics
demographics |>
  tbl_summary()
```
```{r health}
# Health data
health |>
  select(-c(sex)) |>
  tbl_summary()
```

```{r}
# Depression data
depress |>
  select(-c(sex)) |>
  tbl_summary()
```

```{r describe-family-functionality}
# Family functionality
fam_func |>
  select(-c(sex)) |>
  tbl_summary()
```

```{r demo-hbaic}
# Demographics by HBA1C outcome
demographics |>
  tbl_summary(by = hbaic_cat) |>
  add_p() |>
  bold_p()
  
```

```{r demo-func}
# Demographics by family functionality
demographics |>
  tbl_summary(by = functionality_cat) |>
  add_p() |>
  bold_p()
```

```{r demo-depression}
# Demographics by depression
demographics |>
  tbl_summary(by = depression_cat) |>
  add_p() |>
  bold_p()
```



```{r health-hbaic}
# Health characteristics by HBA1C outcome
health |>
  tbl_summary(by = hbaic_cat) |>
  add_p() |>
  bold_p()
```


```{r health-func}
# Health characteristics by family functionality
demographics |>
  tbl_summary(by = functionality_cat) |>
  add_p() |>
  bold_p()
```


```{r health-depression}
# Health characteristics by depression
demographics |>
  tbl_summary(by = depression_cat) |>
  add_p() |>
  bold_p() 
```


# Logistic regression

## Multicolinearity

```{r}
# Convert categorical outcome variable to numeric (binary encoding)
df <- df |>
  mutate(
    hbaic_cat_binary = 
      ifelse(hbaic_cat == "Good control", 0, 1),
    fam_func_binary = 
      ifelse(functionality_cat == "Highly functional", 0, 1),
    depression_binary =
      ifelse(
        depression_cat == "Normal", 0, 1
      )
  )
```


```{r multi-co}
dependent_hb <- "hbaic_cat_binary"
dependent_ff <- "fam_func_binary"
dependent_dep <- "depression_cat"

explanatory <- c(
"sex",                        
"age",                       
"education",                   
"marital_status",              
"religious_background",        
"employment_status",           
"place_of_permanent_residence",
"monthly_income",              
"body_weight",                 
"height",                      
"waist_circumference",         
"hip_circumference",   
"sbp",
"dbp",
"duration_diabetes",
"treatment_diabetes" 
)
```


```{r vif-hbaic}
df |>
  glmmulti(
    dependent_hb, explanatory
  ) |> car::vif()
```




